<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Deployman ‚Ä¢ Tech/DevOps/Dados</title>
  <style>
    body { background-color: #0a0f1f; color: #e6f0ff; font-family: Arial, sans-serif; margin: 0; }
    header, footer { background-color: #10172a; padding: 10px 20px; }
    nav a { color: #7aa2ff; margin: 0 10px; text-decoration: none; }
    nav a:hover { color: #00e5ff; }
    .wrap { max-width: 1100px; margin: auto; padding: 20px; }
    h2 { border-bottom: 1px solid rgba(122,162,255,.25); padding-bottom: 5px; }
    .cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px,1fr)); gap: 16px; }
    .card { background: #10172a; padding: 16px; border-radius: 8px; border: 1px solid rgba(122,162,255,.15); }
    .card h3 { margin: 0 0 8px; word-break: break-word; }
    .meta { font-size: 0.85rem; color: #a8b3cf; }
    .empty { opacity: .7; text-align: center; padding: 18px; }

    /* ===== Ajustes para Markdown n√£o "explodir" ===== */
    .content { margin-top: 10px; overflow-wrap: break-word; word-wrap: break-word; word-break: break-word; }
    .content img { max-width: 100%; height: auto; display: block; border-radius: 6px; }
    .content h1, .content h2 { font-size: 1.15rem; margin: 12px 0 8px; }
    .content h3 { font-size: 1.05rem; margin: 10px 0 6px; }
    .content p, .content ul, .content ol { margin: 8px 0; }
    .content blockquote { margin: 8px 0; padding-left: 10px; border-left: 3px solid rgba(122,162,255,.35); color: #c9d4f0; }

    .content pre { max-width: 100%; overflow: auto; padding: 12px; background: #0b1328; border-radius: 8px; border: 1px solid rgba(122,162,255,.15); }
    .content code { white-space: pre-wrap; word-break: break-word; }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Deployman</h1>
      <nav>
        <a href="#posts">Posts</a>
        <a href="#curiosidades">Curiosidades</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section id="posts">
      <h2>üìù Posts</h2>
      <div id="postsList" class="cards"></div>
      <div id="postsEmpty" class="empty" hidden>Sem posts ainda.</div>
    </section>

    <section id="curiosidades">
      <h2>üí° Curiosidades (DevOps/Tech/Dados/Sec)</h2>
      <div id="curiList" class="cards"></div>
      <div id="curiEmpty" class="empty" hidden>Nenhuma curiosidade publicada ainda.</div>
    </section>
  </main>

  <footer>
    <div class="wrap">
      <div class="meta">¬© <span id="year"></span> Deployman ‚Ä¢ Feito com ‚ô• e GitHub Pages.</div>
    </div>
  </footer>

  <!-- Markdown renderer -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    // Configura√ß√µes do renderer Markdown
    marked.setOptions({ gfm: true, breaks: true, mangle: false, headerIds: false });

    const OWNER = "alexandretho";
    const REPO  = "deployman-site";
    const PER_PAGE = 30;

    const $ = (q)=>document.querySelector(q);
    const el = (tag,cls)=>{ const e=document.createElement(tag); if(cls) e.className=cls; return e };
    const fmtDate = (iso)=> new Date(iso).toLocaleDateString('pt-BR', {year:'numeric',month:'short',day:'2-digit'});

    // Remove front-matter YAML do in√≠cio (--- ... ---)
    function stripFrontMatter(s){
      if(!s) return '';
      const m = s.match(/^---\n[\s\S]*?\n---\n?/);
      return m ? s.slice(m[0].length) : s;
    }

    async function fetchIssuesByLabels(labels){
      const labList = Array.isArray(labels) ? labels : [labels];
      const seen = new Map();
      for(const lab of labList){
        const url = new URL(`https://api.github.com/repos/${OWNER}/${REPO}/issues`);
        url.searchParams.set('state','open');
        url.searchParams.set('labels', lab);
        url.searchParams.set('per_page', PER_PAGE);
        const res = await fetch(url);
        if(!res.ok) continue;
        const items = await res.json();
        for(const i of items){ if(i.pull_request) continue; seen.set(i.number, i); }
      }
      return [...seen.values()];
    }

    function cardForIssue(i){
      const card = el('article','card');
      const h = el('h3'); h.textContent = i.title || 'Sem t√≠tulo';
      const meta = el('div','meta'); meta.textContent = `${fmtDate(i.created_at)} ‚Ä¢ #${i.number}`;
      const content = el('div','content');
      content.innerHTML = marked.parse(stripFrontMatter(i.body || ''));
      const more = el('a'); more.href = i.html_url; more.target = '_blank'; more.rel = 'noopener'; more.textContent = 'Ler no GitHub';
      card.append(h, meta, content, more);
      return card;
    }

    function renderList(container, emptyEl, issues){
      container.innerHTML = '';
      if(!issues.length){ emptyEl.hidden = false; return }
      emptyEl.hidden = true;
      issues.forEach(i => container.appendChild(cardForIssue(i)));
    }

    async function boot(){
      document.getElementById('year').textContent = new Date().getFullYear();
      try{
        const [posts, curis] = await Promise.all([
          fetchIssuesByLabels(['post','posts']),
          fetchIssuesByLabels(['curiosidade','curiosidades'])
        ]);
        renderList($('#postsList'), $('#postsEmpty'), posts);
        renderList($('#curiList'), $('#curiEmpty'), curis);
      }catch(e){
        console.error(e);
        $('#postsEmpty').hidden = false;
        $('#curiEmpty').hidden = false;
      }
    }
    boot();
  </script>
</body>
</html>
